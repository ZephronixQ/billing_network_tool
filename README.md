# billing_network_tool

Асинхронный CLI-инструмент для диагностики ONU на OLT (ZTE ZXAN), ориентированный на стабильный сбор данных **за одну Telnet-сессию** с последующим парсингом.

Проект предназначен для эксплуатации в сетях доступа (GPON/FTTx) и решает задачи оперативной диагностики абонентского оборудования.

---

## Основные возможности

* Поиск ONU по серийному номеру
* Получение порта подключения (PON)
* Сбор IP-статуса (IP / MAC / VLAN)
* Анализ DHCP snooping
* Получение оптических уровней (PON power)
* Определение статуса ONU и интерфейса
* Определение скорости и трафика
* Получение детальных логов (authpass / offline / cause)
* Полностью асинхронная работа (asyncio)
* **Один запрос — одна Telnet-сессия — один буфер данных**

---

## Ключевые архитектурные принципы

### 1. One Session – One Request

После определения интерфейса ONU **все команды выполняются одним `send_bulk`**, а все парсеры работают **строго по одному `raw_all` буферу**.

Это устраняет:

* race condition
* потерю вывода отдельных команд
* нестабильность IP-парсинга
* зависимость от порядка выполнения

---

### 2. Отсутствие повторных запросов

Проект **не использует**:

* повторные попытки
* sleep / retry
* вторичные Telnet-вызовы

Стабильность достигается корректным ожиданием полного CLI-вывода.

---

### 3. Разделение ответственности

* `connection/` — транспорт и Telnet
* `commands/` — только CLI-команды
* `parsers/` — только парсинг текста
* `adapter` — orchestration логика

---

## Структура проекта

```text
billing_network_tool/
│
├── main.py
│
├── cli/
│   ├── args.py
│   └── help.py
│
├── core/
│   ├── connection/
│   │   └── telnet.py
│   │
│   └── operations/
│       ├── uncfg.py
│       ├── search.py
│       ├── ipoe/
│       └── onu/
│           ├── adapter 
│           │   └── zte_zxan_olt.py
│           ├── commands/
│           │   └── zte_zxan.py
│           ├── parsers/
│           │   ├── common.py
│           │   ├── uncfg.py
│           │   ├── search.py
│           │   ├── ip_status.py
│           │   ├── pon_power.py
│           │   ├── speed.py
│           │   └── detail_logs.py
│           └── tables/
│               ├── uncfg.py
│               ├── search.py
│               ├── ip_status.py
│               ├── pon_power.py
│               ├── oper_speed.py
│               └── detail_logs.py
│
├── config/
│   └── secrets.py
│
├── output/
│   ├── colors.py
│   └── table_base.py
│
└── requirements.txt
```

---

## Пример использования

```bash
python3 main.py --sn XCTFAF21084E
```

---

## Пример вывода

```text
✅ ONU FOUND
╒═════════════╤══════════╤══════════════╤══════════╕
│     IP      │   PORT   │    SERIAL    │       ID │
╞═════════════╪══════════╪══════════════╪══════════╡
│ 192.168.2.1 │  1/1/1:1 │ XCTFAF21084E │ 10011710 │
╘═════════════╧══════════╧══════════════╧══════════╛

🌐 IP STATUS
╒═════════════╤════════════════╤════════╕
│     IP      │      MAC       │   VLAN │
╞═════════════╪════════════════╪════════╡
│ 172.10.1.11 │ 0C14.11aa.88cf │   2025 │
╘═════════════╧════════════════╧════════╛

📡 PON POWER LEVELS
╒═══════╤════════════════╤════════════════╤═══════════════╕
│  DIR  │      OLT       │      ONU       │   ATTENUATION │
╞═══════╪════════════════╪════════════════╪═══════════════╡
│  UP   │ Rx -27.786 dBm │  Tx 1.814 dBm  │        29.6   │
├───────┼────────────────┼────────────────┼───────────────┤
│ DOWN  │  Tx 5.027 dBm  │ Rx -20.706 dBm │        25.733 │
╘═══════╧════════════════╧════════════════╧═══════════════╛

⚡ OPERATE / SPEED / THROUGHPUT
╒══════════════════╤════════════════╤═══════════════════════╤════════════════════════╕
│  Operate status  │  Speed status  │   Input rate (Mbit/s) │   Output rate (Mbit/s) │
╞══════════════════╪════════════════╪═══════════════════════╪════════════════════════╡
│      enable      │    full-100    │                 0.018 │                  0.021 │
╘══════════════════╧════════════════╧═══════════════════════╧════════════════════════╛

📝 ONU DETAIL LOGS
╒═════╤═════════════════════╤═════════════════════╤═══════════╕
│   # │    Authpass Time    │    Offline Time     │   Cause   │
╞═════╪═════════════════════╪═════════════════════╪═══════════╡
│   1 │ 2025-12-19 15:46:50 │ 2025-12-22 10:53:25 │ DyingGasp │
├─────┼─────────────────────┼─────────────────────┼───────────┤
│   2 │ 2025-12-22 10:57:43 │ 2025-12-22 13:00:17 │   LOSi    │
├─────┼─────────────────────┼─────────────────────┼───────────┤
│   3 │ 2025-12-22 13:01:35 │ 2025-12-22 16:47:45 │ DyingGasp │
├─────┼─────────────────────┼─────────────────────┼───────────┤
│   4 │ 2025-12-22 16:49:24 │ 2025-12-24 11:09:01 │    LOS    │
├─────┼─────────────────────┼─────────────────────┼───────────┤
│   5 │ 2025-12-24 11:10:19 │ 2025-12-24 11:28:03 │ DyingGasp │
├─────┼─────────────────────┼─────────────────────┼───────────┤
│   6 │ 2025-12-24 11:29:16 │ 2025-12-24 11:30:58 │ DyingGasp │
├─────┼─────────────────────┼─────────────────────┼───────────┤
│   7 │ 2025-12-24 11:32:08 │ 2025-12-24 11:32:24 │ DyingGasp │
├─────┼─────────────────────┼─────────────────────┼───────────┤
│   8 │ 2025-12-24 11:33:09 │ 2025-12-27 18:04:25 │ DyingGasp │
├─────┼─────────────────────┼─────────────────────┼───────────┤
│   9 │ 2025-12-27 18:05:43 │ 2025-12-27 19:36:15 │ DyingGasp │
├─────┼─────────────────────┼─────────────────────┼───────────┤
│  10 │ 2025-12-27 19:37:26 │ 0000-00-00 00:00:00 │           │
╘═════╧═════════════════════╧═════════════════════╧═══════════╛
```

---

## Поддерживаемое оборудование

* ZTE ZXAN OLT
* GPON ONU

---

## Ограничения

* Проект ориентирован на **ZTE ZXAN CLI**
* Для других вендоров требуется отдельный adapter
